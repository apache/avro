<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Avro C++: /home/cutting/src/avro/avro-1.4.1-rc0/lang/c++/api/buffer/Buffer.hh Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_e96cc4a85761e05258d2652b02dee716.html">lang</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_b4c6134b91373158690c9ecfaea98189.html">c++</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_95228ac116598e335a3eba145c54d698.html">api</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_4fa18f951ebc12e3b3044086bdcfeb98.html">buffer</a>
  </div>
</div>
<div class="contents">
<h1>Buffer.hh</h1><a href="Buffer_8hh.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef avro_Buffer_hh__</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define avro_Buffer_hh__</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;sys/uio.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;boost/type_traits.hpp&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="BufferDetail_8hh.html" title="Licensed to the Apache Software Foundation (ASF) under one or more contributor license...">detail/BufferDetail.hh</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="BufferDetailIterator_8hh.html" title="Licensed to the Apache Software Foundation (ASF) under one or more contributor license...">detail/BufferDetailIterator.hh</a>&quot;</span>
<a name="l00028"></a>00028 
<a name="l00036"></a>00036 <span class="keyword">namespace </span>avro {
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">class </span>OutputBuffer;
<a name="l00039"></a>00039 <span class="keyword">class </span>InputBuffer;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00062"></a><a class="code" href="classavro_1_1OutputBuffer.html">00062</a> <span class="keyword">class </span><a class="code" href="classavro_1_1OutputBuffer.html" title="The OutputBuffer (write-only buffer).">OutputBuffer</a> 
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   <span class="keyword">public</span>:
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="keyword">typedef</span> detail::size_type size_type;
<a name="l00068"></a>00068     <span class="keyword">typedef</span> detail::data_type data_type;
<a name="l00069"></a>00069 
<a name="l00077"></a><a class="code" href="classavro_1_1OutputBuffer.html#ae67c361fc5b6f268fd12d85a55b86a64">00077</a>     <span class="keyword">typedef</span> <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">detail::OutputBufferIterator</a> <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a>;
<a name="l00078"></a>00078 
<a name="l00096"></a><a class="code" href="classavro_1_1OutputBuffer.html#a99b1279b6bbd3e531b71dfa79d71d074">00096</a>     <a class="code" href="classavro_1_1OutputBuffer.html#a99b1279b6bbd3e531b71dfa79d71d074" title="Default constructor.">OutputBuffer</a>(size_type reserveSize = 0) :
<a name="l00097"></a>00097         pimpl_(new detail::BufferImpl) 
<a name="l00098"></a>00098     { 
<a name="l00099"></a>00099         <span class="keywordflow">if</span>(reserveSize) { 
<a name="l00100"></a>00100             <a class="code" href="classavro_1_1OutputBuffer.html#a17f9b58f68ef201d6a85fe931eec4d65" title="Reserve enough space for a wroteTo() operation.">reserve</a>(reserveSize); 
<a name="l00101"></a>00101         }
<a name="l00102"></a>00102     }
<a name="l00103"></a>00103 
<a name="l00112"></a><a class="code" href="classavro_1_1OutputBuffer.html#a17f9b58f68ef201d6a85fe931eec4d65">00112</a>     <span class="keywordtype">void</span> <a class="code" href="classavro_1_1OutputBuffer.html#a17f9b58f68ef201d6a85fe931eec4d65" title="Reserve enough space for a wroteTo() operation.">reserve</a>(size_type reserveSize) 
<a name="l00113"></a>00113     {
<a name="l00114"></a>00114         pimpl_-&gt;reserveFreeSpace(reserveSize);
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116 
<a name="l00122"></a><a class="code" href="classavro_1_1OutputBuffer.html#ade76beaf218ebccdc9e7ec189b092728">00122</a>     size_type <a class="code" href="classavro_1_1OutputBuffer.html#ade76beaf218ebccdc9e7ec189b092728" title="Write a block of data to the buffer.">writeTo</a>(<span class="keyword">const</span> data_type *data, size_type <a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed" title="Returns the size of the buffer, in bytes.">size</a>) {
<a name="l00123"></a>00123         <span class="keywordflow">return</span> pimpl_-&gt;writeTo(data, size);
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 
<a name="l00133"></a>00133     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00134"></a><a class="code" href="classavro_1_1OutputBuffer.html#ad564f0e3e833d93368447635a53871cd">00134</a>     <span class="keywordtype">void</span> <a class="code" href="classavro_1_1OutputBuffer.html#ad564f0e3e833d93368447635a53871cd" title="Write a single value to the buffer.">writeTo</a>(T val) {
<a name="l00135"></a>00135         pimpl_-&gt;writeTo(val, boost::is_fundamental&lt;T&gt;());
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00150"></a><a class="code" href="classavro_1_1OutputBuffer.html#aee949a8e2f5e88266f5c15412efa6423">00150</a>     size_type <a class="code" href="classavro_1_1OutputBuffer.html#aee949a8e2f5e88266f5c15412efa6423" title="Update the state of the buffer after writing through the iterator interface.">wroteTo</a>(size_type <a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed" title="Returns the size of the buffer, in bytes.">size</a>) 
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152         <span class="keywordtype">int</span> wrote = 0;
<a name="l00153"></a>00153         <span class="keywordflow">if</span>(size) {
<a name="l00154"></a>00154             <span class="keywordflow">if</span>(size &gt; <a class="code" href="classavro_1_1OutputBuffer.html#a8f3d3641b187c6f3aa525851baae2b20" title="Returns the current free space that is available to write to in the buffer, in bytes...">freeSpace</a>()) {
<a name="l00155"></a>00155                 <span class="keywordflow">throw</span> std::length_error(<span class="stringliteral">&quot;Impossible to write more data than free space&quot;</span>);
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157             wrote = pimpl_-&gt;wroteTo(size);
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159         <span class="keywordflow">return</span> wrote;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161 
<a name="l00166"></a><a class="code" href="classavro_1_1OutputBuffer.html#aeb9399f105de6f35bdde384ceb96c88b">00166</a>     <span class="keywordtype">bool</span> <a class="code" href="classavro_1_1OutputBuffer.html#aeb9399f105de6f35bdde384ceb96c88b" title="Does the buffer have any data?">empty</a>()<span class="keyword"> const </span>{
<a name="l00167"></a>00167         <span class="keywordflow">return</span>  (pimpl_-&gt;size()==0);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00174"></a><a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed">00174</a>     size_type <a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed" title="Returns the size of the buffer, in bytes.">size</a>()<span class="keyword"> const </span>{
<a name="l00175"></a>00175         <span class="keywordflow">return</span>  pimpl_-&gt;size();
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177 
<a name="l00184"></a><a class="code" href="classavro_1_1OutputBuffer.html#a8f3d3641b187c6f3aa525851baae2b20">00184</a>     size_type <a class="code" href="classavro_1_1OutputBuffer.html#a8f3d3641b187c6f3aa525851baae2b20" title="Returns the current free space that is available to write to in the buffer, in bytes...">freeSpace</a>()<span class="keyword"> const </span>{
<a name="l00185"></a>00185         <span class="keywordflow">return</span>  pimpl_-&gt;freeSpace();
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00194"></a>00194     <span class="keyword">template</span> &lt;<span class="keyword">class</span> BufferType&gt;
<a name="l00195"></a><a class="code" href="classavro_1_1OutputBuffer.html#a02aa3adf2d5f0ca56776dc636ffc9cef">00195</a>     <span class="keywordtype">void</span> <a class="code" href="classavro_1_1OutputBuffer.html#a02aa3adf2d5f0ca56776dc636ffc9cef" title="Appends the data in the argument to the end of this buffer.">append</a>(<span class="keyword">const</span> BufferType &amp;buf) {
<a name="l00196"></a>00196         <span class="comment">// don&#39;t append an empty buffer</span>
<a name="l00197"></a>00197         <span class="keywordflow">if</span>(buf.size()) {
<a name="l00198"></a>00198             pimpl_-&gt;append(*(buf.pimpl_.get()));
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 
<a name="l00207"></a><a class="code" href="classavro_1_1OutputBuffer.html#a04fcee45f1da6eb44e918501a10a80c9">00207</a>     <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a> <a class="code" href="classavro_1_1OutputBuffer.html#a04fcee45f1da6eb44e918501a10a80c9" title="Return an iterator pointing to the first data chunk of this buffer that may be written...">begin</a>()<span class="keyword"> const </span>{
<a name="l00208"></a>00208         <span class="keywordflow">return</span> <a class="code" href="classavro_1_1OutputBuffer.html#ae67c361fc5b6f268fd12d85a55b86a64" title="The asio library expects a const_iterator (the const-ness refers to the fact that...">const_iterator</a>(pimpl_-&gt;beginWrite());
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210 
<a name="l00215"></a><a class="code" href="classavro_1_1OutputBuffer.html#a2754e66672a37a681ba4994d86713d74">00215</a>     <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a> <a class="code" href="classavro_1_1OutputBuffer.html#a2754e66672a37a681ba4994d86713d74" title="Return the end iterator for writing.">end</a>()<span class="keyword"> const </span>{
<a name="l00216"></a>00216         <span class="keywordflow">return</span> <a class="code" href="classavro_1_1OutputBuffer.html#ae67c361fc5b6f268fd12d85a55b86a64" title="The asio library expects a const_iterator (the const-ness refers to the fact that...">const_iterator</a>(pimpl_-&gt;endWrite());
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218 
<a name="l00223"></a><a class="code" href="classavro_1_1OutputBuffer.html#a053280750f03b1f4b8a1d5fe0d3bfc49">00223</a>     <span class="keywordtype">void</span> <a class="code" href="classavro_1_1OutputBuffer.html#a053280750f03b1f4b8a1d5fe0d3bfc49" title="Discard any data in this buffer.">discardData</a>()
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         pimpl_-&gt;discardData();
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227 
<a name="l00233"></a><a class="code" href="classavro_1_1OutputBuffer.html#a69b42aea801dc308737003fdff7fc97d">00233</a>     <span class="keywordtype">void</span> <a class="code" href="classavro_1_1OutputBuffer.html#a053280750f03b1f4b8a1d5fe0d3bfc49" title="Discard any data in this buffer.">discardData</a>(<span class="keywordtype">size_t</span> bytes)
<a name="l00234"></a>00234     {
<a name="l00235"></a>00235         <span class="keywordflow">if</span>(bytes &gt; 0) {
<a name="l00236"></a>00236             <span class="keywordflow">if</span>(bytes &lt; pimpl_-&gt;<a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed" title="Returns the size of the buffer, in bytes.">size</a>()) {
<a name="l00237"></a>00237                 pimpl_-&gt;discardData(bytes);
<a name="l00238"></a>00238             }
<a name="l00239"></a>00239             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(bytes == pimpl_-&gt;size()) {
<a name="l00240"></a>00240                 pimpl_-&gt;discardData();
<a name="l00241"></a>00241             }
<a name="l00242"></a>00242             <span class="keywordflow">else</span> {
<a name="l00243"></a>00243                 <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;trying to discard more data than exists&quot;</span>);
<a name="l00244"></a>00244             }
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 
<a name="l00255"></a>00255     <a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a> <a class="code" href="classavro_1_1OutputBuffer.html#a9505cdad23cf1fe6d17bb98fb3bc2cc6" title="Remove all bytes from this buffer, returning them in a new buffer.">extractData</a>(size_type bytes);
<a name="l00256"></a>00256 
<a name="l00262"></a>00262     <a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a> <a class="code" href="classavro_1_1OutputBuffer.html#a9505cdad23cf1fe6d17bb98fb3bc2cc6" title="Remove all bytes from this buffer, returning them in a new buffer.">extractData</a>();
<a name="l00263"></a>00263 
<a name="l00268"></a><a class="code" href="classavro_1_1OutputBuffer.html#a2e7e55053504852314c499637122a630">00268</a>     <a class="code" href="classavro_1_1OutputBuffer.html" title="The OutputBuffer (write-only buffer).">OutputBuffer</a> <a class="code" href="classavro_1_1OutputBuffer.html#a2e7e55053504852314c499637122a630" title="Clone this buffer, creating a copy that contains the same data.">clone</a>()<span class="keyword"> const </span>
<a name="l00269"></a>00269 <span class="keyword">    </span>{
<a name="l00270"></a>00270         detail::BufferImpl::SharedPtr newImpl(<span class="keyword">new</span> <a class="code" href="classavro_1_1detail_1_1BufferImpl.html" title="Implementation details for Buffer class.">detail::BufferImpl</a>(*pimpl_));
<a name="l00271"></a>00271         <span class="keywordflow">return</span> <a class="code" href="classavro_1_1OutputBuffer.html#a99b1279b6bbd3e531b71dfa79d71d074" title="Default constructor.">OutputBuffer</a>(newImpl);
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273 
<a name="l00280"></a><a class="code" href="classavro_1_1OutputBuffer.html#afa42d78b0d86e2783ce273a1e16f6b26">00280</a>     <span class="keywordtype">void</span> <a class="code" href="classavro_1_1OutputBuffer.html#afa42d78b0d86e2783ce273a1e16f6b26" title="Add unmanaged data to the buffer.">appendForeignData</a>(<span class="keyword">const</span> data_type *data, size_type <a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed" title="Returns the size of the buffer, in bytes.">size</a>, <span class="keyword">const</span> detail::free_func &amp;func) {
<a name="l00281"></a>00281         pimpl_-&gt;appendForeignData(data, size, func);
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00288"></a><a class="code" href="classavro_1_1OutputBuffer.html#adc97f1d6ccfdb85030604f4a4962c44a">00288</a>     <span class="keywordtype">int</span> <a class="code" href="classavro_1_1OutputBuffer.html#adc97f1d6ccfdb85030604f4a4962c44a" title="Returns the number of chunks that contain free space.">numChunks</a>()<span class="keyword"> const </span>{
<a name="l00289"></a>00289         <span class="keywordflow">return</span>  pimpl_-&gt;numFreeChunks();
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291 
<a name="l00296"></a><a class="code" href="classavro_1_1OutputBuffer.html#a295597196c670d53029718aac6ea4638">00296</a>     <span class="keywordtype">int</span> <a class="code" href="classavro_1_1OutputBuffer.html#a295597196c670d53029718aac6ea4638" title="Returns the number of chunks that contain data.">numDataChunks</a>()<span class="keyword"> const </span>{
<a name="l00297"></a>00297         <span class="keywordflow">return</span>  pimpl_-&gt;numDataChunks();
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="keyword">private</span>:
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a>;
<a name="l00303"></a>00303     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classavro_1_1BufferReader.html" title="Helper class for reading bytes from buffer without worrying about chunk boundaries...">BufferReader</a>;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="keyword">explicit</span> <a class="code" href="classavro_1_1OutputBuffer.html#a99b1279b6bbd3e531b71dfa79d71d074" title="Default constructor.">OutputBuffer</a>(<span class="keyword">const</span> detail::BufferImpl::SharedPtr &amp;pimpl) :
<a name="l00306"></a>00306         pimpl_(pimpl) 
<a name="l00307"></a>00307     { }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     detail::BufferImpl::SharedPtr pimpl_; 
<a name="l00310"></a>00310 };
<a name="l00311"></a>00311 
<a name="l00326"></a><a class="code" href="classavro_1_1InputBuffer.html">00326</a> <span class="keyword">class </span><a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a> 
<a name="l00327"></a>00327 {
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <span class="keyword">public</span>:
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     <span class="keyword">typedef</span> detail::size_type size_type;
<a name="l00332"></a>00332     <span class="keyword">typedef</span> detail::data_type data_type;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">// needed for asio</span>
<a name="l00335"></a>00335     <span class="keyword">typedef</span> <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">detail::InputBufferIterator</a> <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a>;
<a name="l00336"></a>00336 
<a name="l00348"></a><a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276">00348</a>     <a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276" title="Default InputBuffer creates an empty buffer.">InputBuffer</a>() :
<a name="l00349"></a>00349         pimpl_(new detail::BufferImpl)
<a name="l00350"></a>00350     { }
<a name="l00351"></a>00351 
<a name="l00364"></a><a class="code" href="classavro_1_1InputBuffer.html#adb351c33d1f8f23a7efd0089366fa91c">00364</a>     <a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276" title="Default InputBuffer creates an empty buffer.">InputBuffer</a>(<span class="keyword">const</span> <a class="code" href="classavro_1_1OutputBuffer.html" title="The OutputBuffer (write-only buffer).">OutputBuffer</a> &amp;src) :
<a name="l00365"></a>00365         pimpl_(new detail::BufferImpl(*src.pimpl_))
<a name="l00366"></a>00366     { }
<a name="l00367"></a>00367 
<a name="l00372"></a><a class="code" href="classavro_1_1InputBuffer.html#ae64ab60568f36637a2c90d0c198fd42a">00372</a>     <span class="keywordtype">bool</span> <a class="code" href="classavro_1_1InputBuffer.html#ae64ab60568f36637a2c90d0c198fd42a" title="Does the buffer have any data?">empty</a>()<span class="keyword"> const </span>{
<a name="l00373"></a>00373         <span class="keywordflow">return</span> (pimpl_-&gt;size() == 0);
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375 
<a name="l00380"></a><a class="code" href="classavro_1_1InputBuffer.html#adbfc0b39fcfe37b4fafa63498acc2e4f">00380</a>     size_type <a class="code" href="classavro_1_1InputBuffer.html#adbfc0b39fcfe37b4fafa63498acc2e4f" title="Returns the size of the buffer, in bytes.">size</a>()<span class="keyword"> const </span>{
<a name="l00381"></a>00381         <span class="keywordflow">return</span> pimpl_-&gt;size();
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00389"></a><a class="code" href="classavro_1_1InputBuffer.html#acaf7b2815515be257fce858915c51390">00389</a>     <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a> <a class="code" href="classavro_1_1InputBuffer.html#acaf7b2815515be257fce858915c51390" title="Return an iterator pointing to the first data chunk of this buffer that contains...">begin</a>()<span class="keyword"> const </span>{
<a name="l00390"></a>00390         <span class="keywordflow">return</span> <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a>(pimpl_-&gt;beginRead());
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 
<a name="l00397"></a><a class="code" href="classavro_1_1InputBuffer.html#a72f59cc1edcb9ae8010d12c0fed04d81">00397</a>     <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a> <a class="code" href="classavro_1_1InputBuffer.html#a72f59cc1edcb9ae8010d12c0fed04d81" title="Return the end iterator.">end</a>()<span class="keyword"> const </span>{
<a name="l00398"></a>00398         <span class="keywordflow">return</span> <a class="code" href="classavro_1_1detail_1_1BufferIterator.html" title="Implements the iterator for Buffer, that iterates through the buffer&amp;#39;s chunks...">const_iterator</a>(pimpl_-&gt;endRead());
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400 
<a name="l00405"></a><a class="code" href="classavro_1_1InputBuffer.html#a5c59ebcebdf51b37af46151473be3a49">00405</a>     <span class="keywordtype">int</span> <a class="code" href="classavro_1_1InputBuffer.html#a5c59ebcebdf51b37af46151473be3a49" title="Returns the number of chunks containing data.">numChunks</a>()<span class="keyword"> const </span>{
<a name="l00406"></a>00406         <span class="keywordflow">return</span> pimpl_-&gt;numDataChunks();
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="keyword">private</span>:
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classavro_1_1OutputBuffer.html" title="The OutputBuffer (write-only buffer).">OutputBuffer</a>; <span class="comment">// for append function</span>
<a name="l00413"></a>00413     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classavro_1_1istreambuf.html" title="Implementation of streambuf for use by the Buffer&amp;#39;s istream.">istreambuf</a>;
<a name="l00414"></a>00414     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classavro_1_1BufferReader.html" title="Helper class for reading bytes from buffer without worrying about chunk boundaries...">BufferReader</a>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416     <span class="keyword">explicit</span> <a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276" title="Default InputBuffer creates an empty buffer.">InputBuffer</a>(<span class="keyword">const</span> detail::BufferImpl::SharedPtr &amp;pimpl) :
<a name="l00417"></a>00417         pimpl_(pimpl) 
<a name="l00418"></a>00418     { }
<a name="l00419"></a>00419 
<a name="l00431"></a>00431     <span class="keyword">class </span>ShallowCopy {};
<a name="l00432"></a>00432 
<a name="l00437"></a>00437     <a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276" title="Default InputBuffer creates an empty buffer.">InputBuffer</a>(<span class="keyword">const</span> OutputBuffer &amp;src, <span class="keyword">const</span> ShallowCopy &amp;) : 
<a name="l00438"></a>00438         pimpl_(src.pimpl_)
<a name="l00439"></a>00439     { }
<a name="l00440"></a>00440 
<a name="l00448"></a>00448      <a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276" title="Default InputBuffer creates an empty buffer.">InputBuffer</a>(<span class="keyword">const</span> <a class="code" href="classavro_1_1InputBuffer.html#a21f7eb9315128ab05dc793b98cb2c276" title="Default InputBuffer creates an empty buffer.">InputBuffer</a> &amp;src, <span class="keyword">const</span> ShallowCopy &amp;) : 
<a name="l00449"></a>00449         pimpl_(src.pimpl_)
<a name="l00450"></a>00450     { }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     detail::BufferImpl::ConstSharedPtr pimpl_; 
<a name="l00454"></a>00454 };
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="comment">/* </span>
<a name="l00458"></a>00458 <span class="comment"> * Implementations of some OutputBuffer functions are inlined here</span>
<a name="l00459"></a>00459 <span class="comment"> * because InputBuffer definition was required before.</span>
<a name="l00460"></a>00460 <span class="comment"> */</span>
<a name="l00461"></a>00461 
<a name="l00462"></a><a class="code" href="classavro_1_1OutputBuffer.html#a9505cdad23cf1fe6d17bb98fb3bc2cc6">00462</a> <span class="keyword">inline</span> <a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a> <a class="code" href="classavro_1_1OutputBuffer.html#a9505cdad23cf1fe6d17bb98fb3bc2cc6" title="Remove all bytes from this buffer, returning them in a new buffer.">OutputBuffer::extractData</a>() 
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     detail::BufferImpl::SharedPtr newImpl(<span class="keyword">new</span> <a class="code" href="classavro_1_1detail_1_1BufferImpl.html" title="Implementation details for Buffer class.">detail::BufferImpl</a>);
<a name="l00465"></a>00465     <span class="keywordflow">if</span>(pimpl_-&gt;size()) {
<a name="l00466"></a>00466         pimpl_-&gt;extractData(*newImpl);
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468     <span class="keywordflow">return</span> <a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a>(newImpl);
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="classavro_1_1OutputBuffer.html#a8fbe9fc9167c6df43601f01d49b80bab">00471</a> <span class="keyword">inline</span> <a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a> <a class="code" href="classavro_1_1OutputBuffer.html#a9505cdad23cf1fe6d17bb98fb3bc2cc6" title="Remove all bytes from this buffer, returning them in a new buffer.">OutputBuffer::extractData</a>(size_type bytes)
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473     <span class="keywordflow">if</span>(bytes &gt; pimpl_-&gt;size()) {
<a name="l00474"></a>00474         <span class="keywordflow">throw</span> std::out_of_range(<span class="stringliteral">&quot;trying to extract more data than exists&quot;</span>);
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     detail::BufferImpl::SharedPtr newImpl(<span class="keyword">new</span> <a class="code" href="classavro_1_1detail_1_1BufferImpl.html" title="Implementation details for Buffer class.">detail::BufferImpl</a>);
<a name="l00478"></a>00478     <span class="keywordflow">if</span>(bytes &gt; 0) {
<a name="l00479"></a>00479         <span class="keywordflow">if</span>(bytes &lt; pimpl_-&gt;<a class="code" href="classavro_1_1OutputBuffer.html#aada0bd56bed5196a37d366baa20f34ed" title="Returns the size of the buffer, in bytes.">size</a>()) {
<a name="l00480"></a>00480             pimpl_-&gt;extractData(*newImpl, bytes);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482         <span class="keywordflow">else</span> {
<a name="l00483"></a>00483             pimpl_-&gt;extractData(*newImpl);
<a name="l00484"></a>00484         }
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="keywordflow">return</span> <a class="code" href="classavro_1_1InputBuffer.html" title="The InputBuffer (read-only buffer).">InputBuffer</a>(newImpl);
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00507"></a>00507 <span class="keyword">template</span>&lt;<span class="keyword">class</span> BufferType&gt;
<a name="l00508"></a><a class="code" href="namespaceavro.html#a8ad7f20bacf8a5dc4371f6975774bf53">00508</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespaceavro.html#a8ad7f20bacf8a5dc4371f6975774bf53" title="Create an array of iovec structures from the buffer.">toIovec</a>(BufferType &amp;buf, std::vector&lt;struct iovec&gt; &amp;iov) 
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510     <span class="keyword">const</span> <span class="keywordtype">int</span> chunks = buf.numChunks();
<a name="l00511"></a>00511     iov.resize(chunks);
<a name="l00512"></a>00512     <span class="keyword">typename</span> BufferType::const_iterator iter = buf.begin();
<a name="l00513"></a>00513     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; chunks; ++i) {
<a name="l00514"></a>00514         iov[i].iov_base = <span class="keyword">const_cast&lt;</span>typename BufferType::data_type *<span class="keyword">&gt;</span>(iter-&gt;data());
<a name="l00515"></a>00515         iov[i].iov_len = iter-&gt;size();
<a name="l00516"></a>00516         ++iter;
<a name="l00517"></a>00517     }
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 } <span class="comment">// namespace</span>
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Oct 8 14:36:18 2010 for Avro C++ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
