<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8">
<meta name="Forrest-skin-name" content="pelt">
<title>Avro SASL profile</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="images/favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://hadoop.apache.org/">Hadoop</a> &gt; <a href="http://hadoop.apache.org/avro/">Avro</a><script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://hadoop.apache.org/"><img class="logoImage" alt="Hadoop" src="images/hadoop-logo.jpg" title="Apache Hadoop"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://hadoop.apache.org/avro/"><img class="logoImage" alt="Avro" src="images/avro-logo.png" title="Serialization System"></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="hadoop.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="http://hadoop.apache.org/avro/">Project</a>
</li>
<li>
<a class="unselected" href="http://wiki.apache.org/hadoop/Avro/">Wiki</a>
</li>
<li class="current">
<a class="selected" href="index.html">Avro 1.4.1 Documentation</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Documentation</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html">Overview</a>
</div>
<div class="menuitem">
<a href="spec.html">Specification</a>
</div>
<div class="menuitem">
<a href="api/java/index.html">Java API</a>
</div>
<div class="menuitem">
<a href="api/c/index.html">C API</a>
</div>
<div class="menuitem">
<a href="api/cpp/html/index.html">C++ API</a>
</div>
<div class="menuitem">
<a href="idl.html">IDL language</a>
</div>
<div class="menupage">
<div class="menupagetitle">SASL profile</div>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/hadoop/Avro/">Wiki</a>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/hadoop/Avro/FAQ">FAQ</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sasl.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Avro SASL profile</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#intro">Introduction</a>
</li>
<li>
<a href="#overview">Overview</a>
</li>
<li>
<a href="#negotiation">Negotiation</a>
<ul class="minitoc">
<li>
<a href="#commands">Commands</a>
</li>
<li>
<a href="#process">Process</a>
</li>
</ul>
</li>
<li>
<a href="#session">Session Data</a>
</li>
<li>
<a href="#anonymous">Anonymous Mechanism</a>
</li>
</ul>
</div>
    
<a name="N1000D"></a><a name="intro"></a>
<h2 class="h3">Introduction</h2>
<div class="section">
<p>SASL (<a href="http://www.ietf.org/rfc/rfc2222.txt">RFC 2222</a>)
      provides a framework for authentication and security of network
      protocols.  Each protocol that uses SASL is meant to define a
      SASL <em>profile</em>.  This document provides a SASL profile
      for connection-based Avro RPC.</p>
</div>

    
<a name="N1001E"></a><a name="overview"></a>
<h2 class="h3">Overview</h2>
<div class="section">
<p>SASL negotiation proceeds as a series of message interactions
      over a connection between a client and server using a selected
      SASL <em>mechanism</em>.  The client starts this negotiation by
      sending its chosen mechanism name with an initial (possibly
      empty) message.  Negotiation proceeds with the exchange of
      messages until either side indicates success or failure.  The
      content of the messages is mechanism-specific.  If the
      negotiation succeeds, then the session can proceed over the
      connection, otherwise it must be abandoned.</p>
<p>Some mechanisms continue to process session data after
      negotiation (e.g., encrypting it), while some specify that
      further session data is transmitted unmodifed.</p>
</div>

    
<a name="N1002E"></a><a name="negotiation"></a>
<h2 class="h3">Negotiation</h2>
<div class="section">
<a name="N10034"></a><a name="commands"></a>
<h3 class="h4">Commands</h3>
<p>Avro SASL negotiation uses four one-byte commands.</p>
<ul>
	  
<li>
<span class="codefrag">0: START</span>  Used in a client's initial message.</li>
	  
<li>
<span class="codefrag">1: CONTINUE</span> Used while negotiation is ongoing.</li>
	  
<li>
<span class="codefrag">2: FAIL</span> Terminates negotiation unsuccessfully.</li>
	  
<li>
<span class="codefrag">3: COMPLETE</span> Terminates negotiation sucessfully.</li>
	
</ul>
<p>The format of a START message is:</p>
<pre class="code">| 0 | 4-byte mechanism name length | mechanism name | 4-byte payload length | payload data |</pre>
<p>The format of a CONTINUE message is:</p>
<pre class="code">| 1 | 4-byte payload length | payload data |</pre>
<p>The format of a FAIL message is:</p>
<pre class="code">| 2 | 4-byte message length | UTF-8 message |</pre>
<p>The format of a COMPLETE message is:</p>
<pre class="code">| 3 | 4-byte payload length | payload data |</pre>
<a name="N10071"></a><a name="process"></a>
<h3 class="h4">Process</h3>
<p>Negotiation is initiated by a client sending a START command
	  containing the client's chosen mechanism name and any
	  mechanism-specific payload data.</p>
<p>The server and client then interchange some number
	  (possibly zero) of CONTINUE messages.  Each message contains
	  payload data that is processed by the security mechanism to
	  generate the next message.</p>
<p>Once either the client or server send a FAIL message then
	  negotiation has failed.  UTF-8-encoded text is included in
	  the failure message.  Once either a FAIL message has been
	  sent or recieved, or any other error occurs in the
	  negotiation, further communication on this connection must
	  cease.</p>
<p>Once either the client or server send a COMPLETE message
	  then negotiation has completed successfully.  Session data
	  may now be transmitted over the connection until it is
	  closed by either side.</p>
</div>

    
<a name="N10085"></a><a name="session"></a>
<h2 class="h3">Session Data</h2>
<div class="section">
<p>If no SASL QOP (quality of protection) is negotiated, then
	all subsequent writes to/reads over this connection are
	written/read unmodified.  In particular, messages use
	Avro <a href="spec.html#Message+Framing">framing</a>, and are
	of the form:</p>
<pre class="code">| 4-byte frame length | frame data | ... | 4 zero bytes |</pre>
<p>If a SASL QOP is negotiated, then it must be used by the
	connection for all subsequent messages. This is done by
	wrapping each non-empty frame written using the security
	mechanism and unwrapping each non-empty frame read.  The
	length written in each non-empty frame is the length of the
	wrapped data. Complete frames must be passed to the security
	mechanism for unwrapping.  Unwrapped data is then passed to
	the application as the content of the frame.</p>
<p>If at any point processing fails due to wrapping, unwrapping
	or framing errors, then all further communication on this
	connection must cease.</p>
</div>

    
<a name="N1009D"></a><a name="anonymous"></a>
<h2 class="h3">Anonymous Mechanism</h2>
<div class="section">
<p>The SASL anonymous mechanism
      (<a href="http://www.ietf.org/rfc/rfc2222.txt">RFC 2245</a>) is
      quite simple to implement.  In particular, an initial anonymous
      request may be prefixed by the following static sequence:</p>
<pre class="code">| 0 | 0009 | ANONYMOUS | 0000 |</pre>
<p>If a server uses the anonymous mechanism, it should check
      that the mechanism name in the start message prefixing the first
      request recieved is 'ANONYMOUS', then simply prefix its initial
      response with a COMPLETE message of:</p>
<pre class="code">| 3 | 0000 |</pre>
<p>If an anonymous server recieves some other mechanism name,
      then it may respond with a FAIL message as simple as:</p>
<pre class="code">| 2 | 0000 |</pre>
<p>Note that the anonymous mechanism need add no additional
      round-trip messages between client and server.  The START
      message can be piggybacked on the initial request and the
      COMPLETE or FAIL message can be piggybacked on the initial
      response.</p>
</div>

  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2009 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
