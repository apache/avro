<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.4" />
<title>Avro C</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){generateToc(2)}
/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, October 2006. License: GPL */

function getText(el) {
  var text = "";
  for (var i = el.firstChild; i != null; i = i.nextSibling) {
    if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
      text += i.data;
    else if (i.firstChild != null)
      text += getText(i);
  }
  return text;
}

function TocEntry(el, text, toclevel) {
  this.element = el;
  this.text = text;
  this.toclevel = toclevel;
}

function tocEntries(el, toclevels) {
  var result = new Array;
  var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
  // Function that scans the DOM tree for header elements (the DOM2
  // nodeIterator API would be a better technique but not supported by all
  // browsers).
  var iterate = function (el) {
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
        var mo = re.exec(i.tagName)
        if (mo)
          result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
        iterate(i);
      }
    }
  }
  iterate(el);
  return result;
}

// This function does the work. toclevels = 1..4.
function generateToc(toclevels) {
  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementsByTagName("body")[0], toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "toc" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    document.getElementById("header").removeChild(toc);
}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>Avro C</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>The current version of Avro is <tt>1.3.2</tt>.  The current version of <tt>libavro</tt> is <tt>21:0:0</tt>.
This document was created <tt>2010-03-25</tt>.</p></div>
</div>
</div>
<h2 id="_introduction_to_avro">1. Introduction to Avro</h2>
<div class="sectionbody">
<div class="paragraph"><p>Avro is a data serialization system.</p></div>
<div class="paragraph"><p>Avro provides:</p></div>
<div class="ulist"><ul>
<li>
<p>
Rich data structures.
</p>
</li>
<li>
<p>
A compact, fast, binary data format.
</p>
</li>
<li>
<p>
A container file, to store persistent data.
</p>
</li>
<li>
<p>
Remote procedure call (RPC).
</p>
</li>
</ul></div>
<div class="paragraph"><p>This document will focus on the C implementation of Avro.  To learn more about
Avro in general, <a href="http://hadoop.apache.org/avro/">visit the Avro website</a>.</p></div>
</div>
<h2 id="_introduction_to_avro_c">2. Introduction to Avro C</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>    ___                      ______
   /   |_   ___________     / ____/
  / /| | | / / ___/ __ \   / /
 / ___ | |/ / /  / /_/ /  / /___
/_/  |_|___/_/   \____/   \____/</tt></pre>
</div></div>
<div class="quoteblock">
<div class="quoteblock-content">
<div class="paragraph"><p>A C program is like a fast dance on a newly waxed dance floor by people carrying razors.</p></div>
</div>
<div class="quoteblock-attribution">
<em>(walra%moacs11 @ nl.net) 94/03/18</em><br />
&#8212; Waldi Ravens
</div></div>
<div class="paragraph"><p>The C implementation has been tested on <tt>MacOSX</tt> and <tt>Linux</tt> but, over
time, the number of support OSes should grow.  Please let us know if
you&#8217;re using <tt>Avro C</tt> on other systems. There are no dependencies on
external libraries.  We embedded <a href="http://www.digip.org/jansson/">Jansson</a> into
<tt>Avro C</tt> for parsing JSON into schema structures.</p></div>
<div class="paragraph"><p>The C implementation supports:</p></div>
<div class="ulist"><ul>
<li>
<p>
binary encoding/decoding of all primitive and complex data types
</p>
</li>
<li>
<p>
storage to an Avro Object Container File
</p>
</li>
<li>
<p>
schema resolution, promotion and projection
</p>
</li>
<li>
<p>
validating and non-validating mode for writing Avro data
</p>
</li>
</ul></div>
<div class="paragraph"><p>The C implementation is lacking:</p></div>
<div class="ulist"><ul>
<li>
<p>
RPC
</p>
</li>
</ul></div>
<div class="paragraph"><p>To learn about the API, take a look at the examples and reference files
later in this document.</p></div>
<div class="paragraph"><p>We&#8217;re always looking for contributions so, if you&#8217;re a C hacker, please
feel free to <a href="http://hadoop.apache.org/avro/">submit patches to the
project</a>.</p></div>
</div>
<h2 id="_reference_counting">3. Reference Counting</h2>
<div class="sectionbody">
<div class="paragraph"><p><tt>Avro C</tt> does reference counting for all schema and data objects.
When the number of references drops to zero, the memory is freed.</p></div>
<div class="paragraph"><p>For example, to create and free a string, you would use:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>avro_datum_t string = avro_string("This is my string");

...
avro_datum_decref(string);</tt></pre>
</div></div>
<div class="paragraph"><p>Things get a little more complicated when you consider more elaborate
schema and data structures.</p></div>
<div class="paragraph"><p>For example, let&#8217;s say that you create a record with a single
string field:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>avro_datum_t example = avro_record("Example");
avro_datum_t solo_field = avro_string("Example field value");

avro_record_set(example, "solo", solo_field);

...
avro_datum_decref(example);</tt></pre>
</div></div>
<div class="paragraph"><p>In this example, the <tt>solo_field</tt> datum would <strong>not</strong> be freed since it
has two references: the original reference and a reference inside
the <tt>Example</tt> record.  The <tt>avro_datum_decref(example)</tt> call drops
the number of reference to one.  If you are finished with the <tt>solo_field</tt>
schema, then you need to <tt>avro_schema_decref(solo_field)</tt> to
completely dereference the <tt>solo_field</tt> datum and free it.</p></div>
</div>
<h2 id="_wrap_it_and_give_it">4. Wrap It and Give It</h2>
<div class="sectionbody">
<div class="paragraph"><p>You&#8217;ll notice that some datatypes can be "wrapped" and "given".  This
allows C programmers the freedom to decide who is responsible for
the memory.  Let&#8217;s take strings for example.</p></div>
<div class="paragraph"><p>To create a string datum, you have three different methods:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>avro_datum_t avro_string(const char *str);
avro_datum_t avro_wrapstring(const char *str);
avro_datum_t avro_givestring(const char *str);</tt></pre>
</div></div>
<div class="paragraph"><p>If you use, <tt>avro_string</tt> then <tt>Avro C</tt> will make a copy of your
string and free it when the datum is dereferenced.  In some cases,
especially when dealing with large amounts of data, you want
to avoid this memory copy.  That&#8217;s where <tt>avro_wrapstring</tt> and
<tt>avro_givestring</tt> can help.</p></div>
<div class="paragraph"><p>If you use, <tt>avro_wrapstring</tt> then <tt>Avro C</tt> will do no memory
management at all.  It will just save a pointer to your data and
it&#8217;s your responsibility to free the string.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">When using <tt>avro_wrapstring</tt>, do not free the string
before you dereference the string datum with <tt>avro_datum_decref()</tt>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Lastly, if you use <tt>avro_givestring</tt> then <tt>Avro C</tt> will free the
string later when the datum is dereferenced.  In a sense, you
are "giving" responsibility for freeing the string to <tt>Avro C</tt>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph"><p>Don&#8217;t "give" <tt>Avro C</tt> a string that you haven&#8217;t allocated from the heap with e.g. <tt>malloc</tt> or <tt>strdup</tt>.</p></div>
<div class="paragraph"><p>For example, <strong>don&#8217;t</strong> do this:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>avro_datum_t bad_idea = avro_givestring("This isn't allocated on the heap");</tt></pre>
</div></div>
</td>
</tr></table>
</div>
</div>
<h2 id="_schema_validation">5. Schema Validation</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you want to write a datum, you would use the following function</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_write_data</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">,</span>
                    <span style="color: #008080">avro_schema_t</span> writers_schema<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>If you pass in a <tt>writers_schema</tt>, then you <tt>datum</tt> will be validated <strong>before</strong>
it is sent to the <tt>writer</tt>.  This check ensures that your data has the
correct format.  If you are certain your datum is correct, you can pass
a <tt>NULL</tt> value for <tt>writers_schema</tt> and <tt>Avro C</tt> will not validate before
writing.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Data written to an Avro File Object Container is always validated.</td>
</tr></table>
</div>
</div>
<h2 id="_examples">6. Examples</h2>
<div class="sectionbody">
<div class="quoteblock">
<div class="quoteblock-content">
<div class="paragraph"><p>I&#8217;m not even supposed to be here today!</p></div>
</div>
<div class="quoteblock-attribution">
&#8212; Dante Hicks
</div></div>
<div class="paragraph"><p>Imagine you&#8217;re a free-lance hacker in Leonardo, New Jersey and you&#8217;ve
been approached by the owner of the local <strong>Quick Stop Convenience</strong> store.
He wants you to create a contact database case he needs to call employees
to work on their day off.</p></div>
<div class="paragraph"><p>You might build a simple contact system using Avro C like the following&#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * contributor license agreements.  See the NOTICE file distributed with</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * this work for additional information regarding copyright ownership.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * The ASF licenses this file to you under the Apache License, Version 2.0</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * (the "License"); you may not use this file except in compliance with</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * the License.  You may obtain a copy of the License at</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * </span></span><span style="text-decoration: underline"><span style="color: #0000FF">http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Unless required by applicable law or agreed to in writing, software</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * distributed under the License is distributed on an "AS IS" BASIS,</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * implied.  See the License for the specific language governing</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * permissions and limitations under the License.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;avro.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;inttypes.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;unistd.h&gt;</span>

<span style="color: #008080">avro_schema_t</span> person_schema<span style="color: #990000">;</span>
<span style="color: #008080">int64_t</span> id <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">/* A simple schema for our tutorial */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> PERSON_SCHEMA <span style="color: #990000">\</span>
<span style="color: #FF0000">"{</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">type</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">:</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">record</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">,\</span>
<span style="color: #FF0000">  </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">name</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">:</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">Person</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">,\</span>
<span style="color: #FF0000">  </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">fields</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">:[\</span>
<span style="color: #FF0000">     {</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">name</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">ID</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">type</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">long</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">},\</span>
<span style="color: #FF0000">     {</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">name</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">First</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">type</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">string</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">},\</span>
<span style="color: #FF0000">     {</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">name</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">Last</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">type</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">string</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">},\</span>
<span style="color: #FF0000">     {</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">name</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">Phone</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">type</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">string</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">},\</span>
<span style="color: #FF0000">     {</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">name</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">Age</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">, </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">type</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">: </span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">int</span><span style="color: #CC33CC">\"</span><span style="color: #FF0000">}]}"</span>

<span style="font-style: italic"><span style="color: #9A1900">/* Parse schema into a schema data structure */</span></span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">init_schema</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_schema_error_t</span> error<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_schema_from_json</span></span><span style="color: #990000">(</span>PERSON_SCHEMA<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>PERSON_SCHEMA<span style="color: #990000">),</span>
                                  <span style="color: #990000">&amp;</span>person_schema<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>error<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Unable to parse person schema</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/* Create a datum to match the person schema and save it */</span></span>
<span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_writer_t</span> db<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>first<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>last<span style="color: #990000">,</span>
           <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>phone<span style="color: #990000">,</span> <span style="color: #008080">int32_t</span> age<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_datum_t</span> person <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_record</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Person"</span><span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>

        <span style="color: #008080">avro_datum_t</span> id_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int64</span></span><span style="color: #990000">(++</span>id<span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> first_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_string</span></span><span style="color: #990000">(</span>first<span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> last_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_string</span></span><span style="color: #990000">(</span>last<span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> age_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32</span></span><span style="color: #990000">(</span>age<span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> phone_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_string</span></span><span style="color: #990000">(</span>phone<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"ID"</span><span style="color: #990000">,</span> id_datum<span style="color: #990000">)</span>
            <span style="color: #990000">||</span> <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"First"</span><span style="color: #990000">,</span> first_datum<span style="color: #990000">)</span>
            <span style="color: #990000">||</span> <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"Last"</span><span style="color: #990000">,</span> last_datum<span style="color: #990000">)</span>
            <span style="color: #990000">||</span> <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"Age"</span><span style="color: #990000">,</span> age_datum<span style="color: #990000">)</span>
            <span style="color: #990000">||</span> <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"Phone"</span><span style="color: #990000">,</span> phone_datum<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Unable to create Person datum structure"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_file_writer_append</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> person<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span>
                        <span style="color: #FF0000">"Unable to write Person datum to memory buffer"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* Decrement all our references to prevent memory from leaking */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>id_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>first_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>last_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>age_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>phone_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>person<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"Successfully added %s, %s id=%"</span>PRId64<span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> last<span style="color: #990000">,</span> first<span style="color: #990000">,</span> id<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">print_person</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_reader_t</span> db<span style="color: #990000">,</span> <span style="color: #008080">avro_schema_t</span> reader_schema<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> rval<span style="color: #990000">;</span>
        <span style="color: #008080">avro_datum_t</span> person<span style="color: #990000">;</span>

        rval <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_reader_read</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> reader_schema<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>person<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>rval <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">int64_t</span> i64<span style="color: #990000">;</span>
                <span style="color: #008080">int32_t</span> i32<span style="color: #990000">;</span>
                <span style="color: #009900">char</span> <span style="color: #990000">*</span>p<span style="color: #990000">;</span>
                <span style="color: #008080">avro_datum_t</span> id_datum<span style="color: #990000">,</span> first_datum<span style="color: #990000">,</span> last_datum<span style="color: #990000">,</span> phone_datum<span style="color: #990000">,</span>
                    age_datum<span style="color: #990000">;</span>

                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_record_get</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"ID"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>id_datum<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">avro_int64_get</span></span><span style="color: #990000">(</span>id_datum<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>i64<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"%"</span>PRId64<span style="color: #FF0000">" | "</span><span style="color: #990000">,</span> i64<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_record_get</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"First"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>first_datum<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">avro_string_get</span></span><span style="color: #990000">(</span>first_datum<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>p<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"%15s | "</span><span style="color: #990000">,</span> p<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_record_get</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"Last"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>last_datum<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">avro_string_get</span></span><span style="color: #990000">(</span>last_datum<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>p<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"%15s | "</span><span style="color: #990000">,</span> p<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_record_get</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"Phone"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>phone_datum<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">avro_string_get</span></span><span style="color: #990000">(</span>phone_datum<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>p<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"%15s | "</span><span style="color: #990000">,</span> p<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_record_get</span></span><span style="color: #990000">(</span>person<span style="color: #990000">,</span> <span style="color: #FF0000">"Age"</span><span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>age_datum<span style="color: #990000">)</span> <span style="color: #990000">==</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">avro_int32_get</span></span><span style="color: #990000">(</span>age_datum<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>i32<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"%d"</span><span style="color: #990000">,</span> i32<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>

                <span style="font-style: italic"><span style="color: #9A1900">/* We no longer need this memory */</span></span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>person<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> rval<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> rval<span style="color: #990000">;</span>
        <span style="color: #008080">avro_file_reader_t</span> dbreader<span style="color: #990000">;</span>
        <span style="color: #008080">avro_file_writer_t</span> db<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> projection_schema<span style="color: #990000">,</span> first_name_schema<span style="color: #990000">,</span> phone_schema<span style="color: #990000">;</span>
        <span style="color: #008080">int64_t</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>dbname <span style="color: #990000">=</span> <span style="color: #FF0000">"quickstop.db"</span><span style="color: #990000">;</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* Initialize the schema structure from JSON */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">init_schema</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* Delete the database if it exists */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">unlink</span></span><span style="color: #990000">(</span>dbname<span style="color: #990000">);</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* Create a new database */</span></span>
        rval <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_create</span></span><span style="color: #990000">(</span>dbname<span style="color: #990000">,</span> person_schema<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>db<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>rval<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"There was an error creating %s</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> dbname<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-style: italic"><span style="color: #9A1900">/* Add people to the database */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> <span style="color: #FF0000">"Dante"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Hicks"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"(555) 123-4567"</span><span style="color: #990000">,</span> <span style="color: #993399">32</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> <span style="color: #FF0000">"Randal"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Graves"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"(555) 123-5678"</span><span style="color: #990000">,</span> <span style="color: #993399">30</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> <span style="color: #FF0000">"Veronica"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Loughran"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"(555) 123-0987"</span><span style="color: #990000">,</span> <span style="color: #993399">28</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> <span style="color: #FF0000">"Caitlin"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Bree"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"(555) 123-2323"</span><span style="color: #990000">,</span> <span style="color: #993399">27</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> <span style="color: #FF0000">"Bob"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Silent"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"(555) 123-6422"</span><span style="color: #990000">,</span> <span style="color: #993399">29</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">add_person</span></span><span style="color: #990000">(</span>db<span style="color: #990000">,</span> <span style="color: #FF0000">"Jay"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"???"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"(555) 123-9182"</span><span style="color: #990000">,</span> <span style="color: #993399">26</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_close</span></span><span style="color: #990000">(</span>db<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">Now let's read all the records back out</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* Read all the records and print them */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">avro_file_reader</span></span><span style="color: #990000">(</span>dbname<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>dbreader<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> id<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">print_person</span></span><span style="color: #990000">(</span>dbreader<span style="color: #990000">,</span> NULL<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Error printing person</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_file_reader_close</span></span><span style="color: #990000">(</span>dbreader<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* You can also use projection, to only decode only the data you are</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           interested in.  This is particularly useful when you have</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           huge data sets and you'll only interest in particular fields</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           e.g. your contacts First name and phone number */</span></span>
        projection_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_record</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Person"</span><span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        first_name_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_string</span></span><span style="color: #990000">();</span>
        phone_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_string</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_record_field_append</span></span><span style="color: #990000">(</span>projection_schema<span style="color: #990000">,</span> <span style="color: #FF0000">"First"</span><span style="color: #990000">,</span>
                                        first_name_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_record_field_append</span></span><span style="color: #990000">(</span>projection_schema<span style="color: #990000">,</span> <span style="color: #FF0000">"Phone"</span><span style="color: #990000">,</span>
                                        phone_schema<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* Read only the record you're interested in */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stdout<span style="color: #990000">,</span>
                <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n\n</span><span style="color: #FF0000">Use projection to print only the First name and phone numbers</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_file_reader</span></span><span style="color: #990000">(</span>dbname<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>dbreader<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> id<span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">print_person</span></span><span style="color: #990000">(</span>dbreader<span style="color: #990000">,</span> projection_schema<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Error printing person</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_file_reader_close</span></span><span style="color: #990000">(</span>dbreader<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>first_name_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>phone_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>projection_schema<span style="color: #990000">);</span>

        <span style="font-style: italic"><span style="color: #9A1900">/* We don't need this schema anymore */</span></span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>person_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>When you compile and run this program, you should get the following output</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>Successfully added Hicks, Dante id=1
Successfully added Graves, Randal id=2
Successfully added Loughran, Veronica id=3
Successfully added Bree, Caitlin id=4
Successfully added Silent, Bob id=5
Successfully added ???, Jay id=6

Avro is compact. Here is the data for all 6 people.
| 02 0A 44 61 6E 74 65 0A | 48 69 63 6B 73 1C 28 35 |   ..Dante.Hicks.(5
| 35 35 29 20 31 32 33 2D | 34 35 36 37 40 04 0C 52 |   55) 123-4567@..R
| 61 6E 64 61 6C 0C 47 72 | 61 76 65 73 1C 28 35 35 |   andal.Graves.(55
| 35 29 20 31 32 33 2D 35 | 36 37 38 3C 06 10 56 65 |   5) 123-5678&lt;..Ve
| 72 6F 6E 69 63 61 10 4C | 6F 75 67 68 72 61 6E 1C |   ronica.Loughran.
| 28 35 35 35 29 20 31 32 | 33 2D 30 39 38 37 38 08 |   (555) 123-09878.
| 0E 43 61 69 74 6C 69 6E | 08 42 72 65 65 1C 28 35 |   .Caitlin.Bree.(5
| 35 35 29 20 31 32 33 2D | 32 33 32 33 36 0A 06 42 |   55) 123-23236..B
| 6F 62 0C 53 69 6C 65 6E | 74 1C 28 35 35 35 29 20 |   ob.Silent.(555)
| 31 32 33 2D 36 34 32 32 | 3A 0C 06 4A 61 79 06 3F |   123-6422:..Jay.?
| 3F 3F 1C 28 35 35 35 29 | 20 31 32 33 2D 39 31 38 |   ??.(555) 123-918
| 32 34 .. .. .. .. .. .. | .. .. .. .. .. .. .. .. |   24..............

Now let's read all the records back out
1 |           Dante |           Hicks |  (555) 123-4567 | 32
2 |          Randal |          Graves |  (555) 123-5678 | 30
3 |        Veronica |        Loughran |  (555) 123-0987 | 28
4 |         Caitlin |            Bree |  (555) 123-2323 | 27
5 |             Bob |          Silent |  (555) 123-6422 | 29
6 |             Jay |             ??? |  (555) 123-9182 | 26


Use projection to print only the First name and phone numbers
          Dante |  (555) 123-4567 |
         Randal |  (555) 123-5678 |
       Veronica |  (555) 123-0987 |
        Caitlin |  (555) 123-2323 |
            Bob |  (555) 123-6422 |
            Jay |  (555) 123-9182 |</tt></pre>
</div></div>
<div class="paragraph"><p>The <strong>Quick Stop</strong> owner was so pleased, he asked you to create a
movie database for his <strong>RST Video</strong> store.</p></div>
</div>
<h2 id="_reference_files">7. Reference files</h2>
<div class="sectionbody">
<h3 id="_avro_h">7.1. avro.h</h3><div style="clear:left"></div>
<div class="paragraph"><p>The <tt>avro.h</tt> header file contains the complete public API
for <tt>Avro C</tt>.  The documentation is rather sparse right now
but we&#8217;ll be adding more information soon.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * contributor license agreements.  See the NOTICE file distributed with</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * this work for additional information regarding copyright ownership.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * The ASF licenses this file to you under the Apache License, Version 2.0</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * (the "License"); you may not use this file except in compliance with</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * the License.  You may obtain a copy of the License at</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * </span></span><span style="text-decoration: underline"><span style="color: #0000FF">http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Unless required by applicable law or agreed to in writing, software</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * distributed under the License is distributed on an "AS IS" BASIS,</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * implied.  See the License for the specific language governing</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * permissions and limitations under the License.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="font-weight: bold"><span style="color: #000080">#ifndef</span></span> AVRO_H
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> AVRO_H
<span style="font-weight: bold"><span style="color: #000080">#ifdef</span></span> __cplusplus
<span style="font-weight: bold"><span style="color: #0000FF">extern</span></span> <span style="color: #FF0000">"C"</span> <span style="color: #FF0000">{</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> CLOSE_EXTERN <span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000080">#else</span></span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> CLOSE_EXTERN
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdio.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdint.h&gt;</span>

<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span> avro_type_t <span style="color: #FF0000">{</span>
        AVRO_STRING<span style="color: #990000">,</span>
        AVRO_BYTES<span style="color: #990000">,</span>
        AVRO_INT32<span style="color: #990000">,</span>
        AVRO_INT64<span style="color: #990000">,</span>
        AVRO_FLOAT<span style="color: #990000">,</span>
        AVRO_DOUBLE<span style="color: #990000">,</span>
        AVRO_BOOLEAN<span style="color: #990000">,</span>
        AVRO_NULL<span style="color: #990000">,</span>
        AVRO_RECORD<span style="color: #990000">,</span>
        AVRO_ENUM<span style="color: #990000">,</span>
        AVRO_FIXED<span style="color: #990000">,</span>
        AVRO_MAP<span style="color: #990000">,</span>
        AVRO_ARRAY<span style="color: #990000">,</span>
        AVRO_UNION<span style="color: #990000">,</span>
        AVRO_LINK
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">enum</span></span> <span style="color: #008080">avro_type_t</span> avro_type_t<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">enum</span></span> avro_class_t <span style="color: #FF0000">{</span>
        AVRO_SCHEMA<span style="color: #990000">,</span>
        AVRO_DATUM
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">enum</span></span> <span style="color: #008080">avro_class_t</span> avro_class_t<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_obj_t</span> <span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_type_t</span> type<span style="color: #990000">;</span>
        <span style="color: #008080">avro_class_t</span> class_type<span style="color: #990000">;</span>
        <span style="color: #009900">unsigned</span> <span style="color: #009900">long</span> refcount<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">avro_classof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>     <span style="color: #990000">((</span>obj<span style="color: #990000">)-&gt;</span>class_type<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_schema</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>   <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_classof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_SCHEMA<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_datum</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_classof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_DATUM<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>      <span style="color: #990000">((</span>obj<span style="color: #990000">)-&gt;</span>type<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_string</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>   <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_STRING<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_bytes</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_BYTES<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_int32</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_INT32<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_int64</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_INT64<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_float</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_FLOAT<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_double</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>   <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_DOUBLE<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_boolean</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>  <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_BOOLEAN<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_null</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>     <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_NULL<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_primitive</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)(</span><span style="font-weight: bold"><span style="color: #000000">is_avro_string</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_bytes</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_int32</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_int64</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_float</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_double</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_boolean</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                             <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_null</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_record</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>   <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_RECORD<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_enum</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>     <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_ENUM<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_fixed</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_FIXED<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_named_type</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)(</span><span style="font-weight: bold"><span style="color: #000000">is_avro_record</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                              <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_enum</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">\</span>
                              <span style="color: #990000">||</span><span style="font-weight: bold"><span style="color: #000000">is_avro_fixed</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_map</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>      <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_MAP<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_array</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_ARRAY<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_union</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>    <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_UNION<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_complex_type</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">(!(</span><span style="font-weight: bold"><span style="color: #000000">is_avro_primitive</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">#define</span></span> <span style="font-weight: bold"><span style="color: #000000">is_avro_link</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span>     <span style="color: #990000">(</span>obj <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">avro_typeof</span></span><span style="color: #990000">(</span>obj<span style="color: #990000">)</span> <span style="color: #990000">==</span> AVRO_LINK<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_reader_t_</span> <span style="color: #990000">*</span>avro_reader_t<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_writer_t_</span> <span style="color: #990000">*</span>avro_writer_t<span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * schema</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_obj_t</span> <span style="color: #990000">*</span>avro_schema_t<span style="color: #990000">;</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_string</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_bytes</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_int</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_long</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_float</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_double</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_boolean</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_null</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_record</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>space<span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_record_field_get</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> avro_schema_t
                                           record<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>field_name<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_record_field_append</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_schema_t</span> record<span style="color: #990000">,</span>
                                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>field_name<span style="color: #990000">,</span>
                                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_schema_t</span> type<span style="color: #990000">);</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum_symbol_append</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> avro_schema_t
                                   enump<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>symbol<span style="color: #990000">);</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_fixed</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_map</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_schema_t</span> values<span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_array</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_schema_t</span> items<span style="color: #990000">);</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_union</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_union_append</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> avro_schema_t
                             union_schema<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">);</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_link</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_schema_error_t_</span> <span style="color: #990000">*</span>avro_schema_error_t<span style="color: #990000">;</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_from_json</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>jsontext<span style="color: #990000">,</span>
                          <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int32_t</span> len<span style="color: #990000">,</span>
                          avro_schema_t <span style="color: #990000">*</span> schema<span style="color: #990000">,</span> avro_schema_error_t <span style="color: #990000">*</span> error<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_to_json</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">,</span> <span style="color: #008080">avro_writer_t</span> out<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_to_specific</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>prefix<span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span><span style="font-weight: bold"><span style="color: #000000">avro_schema_name</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">);</span>
<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_copy</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_equal</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> a<span style="color: #990000">,</span> <span style="color: #008080">avro_schema_t</span> b<span style="color: #990000">);</span>

<span style="color: #008080">avro_schema_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_incref</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * io</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>
<span style="color: #008080">avro_reader_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_reader_file</span></span><span style="color: #990000">(</span>FILE <span style="color: #990000">*</span> fp<span style="color: #990000">);</span>
<span style="color: #008080">avro_writer_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_file</span></span><span style="color: #990000">(</span>FILE <span style="color: #990000">*</span> fp<span style="color: #990000">);</span>
<span style="color: #008080">avro_reader_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_reader_memory</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #008080">avro_writer_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_memory</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_read</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">,</span> <span style="color: #009900">void</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_skip</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_write</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">,</span> <span style="color: #009900">void</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_reset</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">);</span>
<span style="color: #008080">int64_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_tell</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_flush</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">);</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_dump</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">,</span> FILE <span style="color: #990000">*</span> fp<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_reader_dump</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">,</span> FILE <span style="color: #990000">*</span> fp<span style="color: #990000">);</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_reader_free</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_free</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * datum</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>

<span style="font-style: italic"><span style="color: #9A1900">/* constructors */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_obj_t</span> <span style="color: #990000">*</span>avro_datum_t<span style="color: #990000">;</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_string</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>str<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapstring</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>str<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_givestring</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>str<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_bytes</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapbytes</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_givebytes</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>buf<span style="color: #990000">,</span> <span style="color: #008080">int64_t</span> len<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32</span></span><span style="color: #990000">(</span><span style="color: #008080">int32_t</span> i<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_int64</span></span><span style="color: #990000">(</span><span style="color: #008080">int64_t</span> l<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_float</span></span><span style="color: #990000">(</span><span style="color: #009900">float</span> f<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_double</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> d<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_boolean</span></span><span style="color: #990000">(</span><span style="color: #008080">int8_t</span> i<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_null</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_record</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>space<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_enum</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="color: #009900">int</span> i<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_fixed</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapfixed</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_givefixed</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_map</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_array</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_union</span></span><span style="color: #990000">(</span><span style="color: #008080">int64_t</span> discriminant<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">/* getters */</span></span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_string_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>p<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_bytes_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>bytes<span style="color: #990000">,</span> int64_t <span style="color: #990000">*</span> size<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> int32_t <span style="color: #990000">*</span> i<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_int64_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> int64_t <span style="color: #990000">*</span> l<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_float_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="color: #009900">float</span> <span style="color: #990000">*</span>f<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_double_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="color: #009900">double</span> <span style="color: #990000">*</span>d<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_boolean_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> int8_t <span style="color: #990000">*</span> i<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_fixed_get</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">**</span>bytes<span style="color: #990000">,</span> int64_t <span style="color: #990000">*</span> size<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_record_get</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> record<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>field_name<span style="color: #990000">,</span>
                    avro_datum_t <span style="color: #990000">*</span> value<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_map_get</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>key<span style="color: #990000">,</span>
                 avro_datum_t <span style="color: #990000">*</span> value<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">/* setters */</span></span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_string_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>p<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_givestring_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>p<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapstring_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>p<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_bytes_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_givebytes_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                       <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapbytes_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                       <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int32_t</span> i<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_int64_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> l<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_float_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">float</span> f<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_double_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">double</span> d<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_boolean_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int8_t</span> i<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_fixed_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_givefixed_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                       <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapfixed_set</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>bytes<span style="color: #990000">,</span>
                       <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">int64_t</span> size<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> record<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>field_name<span style="color: #990000">,</span>
                    <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> value<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_map_set</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> map<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>key<span style="color: #990000">,</span>
                 <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> value<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_array_append_datum</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> array_datum<span style="color: #990000">,</span>
                            <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">/* reference counting */</span></span>
<span style="color: #008080">avro_datum_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_datum_incref</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> value<span style="color: #990000">);</span>
<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> value<span style="color: #990000">);</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">avro_datum_print</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> value<span style="color: #990000">,</span> FILE <span style="color: #990000">*</span> fp<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_datum_equal</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_datum_t</span> a<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> b<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_match</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> writers_schema<span style="color: #990000">,</span>
                      <span style="color: #008080">avro_schema_t</span> readers_schema<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_datum_validate</span></span><span style="color: #990000">(</span>avro_schema_t
                               expected_schema<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_read_data</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">,</span>
                   <span style="color: #008080">avro_schema_t</span> writer_schema<span style="color: #990000">,</span>
                   <span style="color: #008080">avro_schema_t</span> reader_schema<span style="color: #990000">,</span> avro_datum_t <span style="color: #990000">*</span> datum<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_skip_data</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">,</span> <span style="color: #008080">avro_schema_t</span> writer_schema<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_write_data</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">,</span>
                    <span style="color: #008080">avro_schema_t</span> writer_schema<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span>
<span style="color: #008080">int64_t</span> <span style="font-weight: bold"><span style="color: #000000">avro_size_data</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">,</span>
                       <span style="color: #008080">avro_schema_t</span> writer_schema<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">/* File object container */</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_file_reader_t_</span> <span style="color: #990000">*</span>avro_file_reader_t<span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_file_writer_t_</span> <span style="color: #990000">*</span>avro_file_writer_t<span style="color: #990000">;</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_create</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>path<span style="color: #990000">,</span> <span style="color: #008080">avro_schema_t</span> schema<span style="color: #990000">,</span>
                            avro_file_writer_t <span style="color: #990000">*</span> writer<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_open</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>path<span style="color: #990000">,</span> avro_file_writer_t <span style="color: #990000">*</span> writer<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_reader</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>path<span style="color: #990000">,</span> avro_file_reader_t <span style="color: #990000">*</span> reader<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_append</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_writer_t</span> writer<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_sync</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_writer_t</span> writer<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_flush</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_writer_t</span> writer<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_writer_close</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_writer_t</span> writer<span style="color: #990000">);</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_reader_read</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_reader_t</span> reader<span style="color: #990000">,</span>
                          <span style="color: #008080">avro_schema_t</span> readers_schema<span style="color: #990000">,</span> avro_datum_t <span style="color: #990000">*</span> datum<span style="color: #990000">);</span>
<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">avro_file_reader_close</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_file_reader_t</span> reader<span style="color: #990000">);</span>

CLOSE_EXTERN
<span style="font-weight: bold"><span style="color: #000080">#endif</span></span></tt></pre></div></div>
<h3 id="_test_avro_data_c">7.2. test_avro_data.c</h3><div style="clear:left"></div>
<div class="paragraph"><p>Another good way to learn how to encode/decode data in <tt>Avro C</tt> is
to look at the <tt>test_avro_data.c</tt> unit test.  This simple unit test
checks that all the avro types can be encoded/decoded correctly.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Licensed to the Apache Software Foundation (ASF) under one or more</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * contributor license agreements.  See the NOTICE file distributed with</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * this work for additional information regarding copyright ownership.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * The ASF licenses this file to you under the Apache License, Version 2.0</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * (the "License"); you may not use this file except in compliance with</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * the License.  You may obtain a copy of the License at</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * </span></span><span style="text-decoration: underline"><span style="color: #0000FF">http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> *</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * Unless required by applicable law or agreed to in writing, software</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * distributed under the License is distributed on an "AS IS" BASIS,</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * implied.  See the License for the specific language governing</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> * permissions and limitations under the License.</span></span>
<span style="font-style: italic"><span style="color: #9A1900"> */</span></span>

<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">"avro_private.h"</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;inttypes.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;limits.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;stdlib.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;string.h&gt;</span>
<span style="font-weight: bold"><span style="color: #000080">#include</span></span> <span style="color: #FF0000">&lt;time.h&gt;</span>

<span style="color: #009900">char</span> buf<span style="color: #990000">[</span><span style="color: #993399">4096</span><span style="color: #990000">];</span>
<span style="color: #008080">avro_reader_t</span> reader<span style="color: #990000">;</span>
<span style="color: #008080">avro_writer_t</span> writer<span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">typedef</span></span> <span style="color: #009900">int</span> <span style="color: #990000">(*</span>avro_test<span style="color: #990000">)</span> <span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">);</span>

<span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">init_rand</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #000000">srand</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">time</span></span><span style="color: #990000">(</span>NULL<span style="color: #990000">));</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">double</span> <span style="font-weight: bold"><span style="color: #000000">rand_number</span></span><span style="color: #990000">(</span><span style="color: #009900">double</span> from<span style="color: #990000">,</span> <span style="color: #009900">double</span> to<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">double</span> range <span style="color: #990000">=</span> to <span style="color: #990000">-</span> from<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> from <span style="color: #990000">+</span> <span style="color: #990000">((</span><span style="color: #009900">double</span><span style="color: #990000">)</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">()</span> <span style="color: #990000">/</span> <span style="color: #990000">(</span>RAND_MAX <span style="color: #990000">+</span> <span style="color: #993399">1.0</span><span style="color: #990000">))</span> <span style="color: #990000">*</span> range<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">int64_t</span> <span style="font-weight: bold"><span style="color: #000000">rand_int64</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>int64_t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">rand_number</span></span><span style="color: #990000">(</span>LONG_MIN<span style="color: #990000">,</span> LONG_MAX<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">int32_t</span> <span style="font-weight: bold"><span style="color: #000000">rand_int32</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>int32_t<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #000000">rand_number</span></span><span style="color: #990000">(</span>INT_MIN<span style="color: #990000">,</span> INT_MAX<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">void</span>
<span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span><span style="color: #008080">avro_schema_t</span> writers_schema<span style="color: #990000">,</span>
                 <span style="color: #008080">avro_schema_t</span> readers_schema<span style="color: #990000">,</span> <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">,</span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>type<span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_datum_t</span> datum_out<span style="color: #990000">;</span>
        <span style="color: #009900">int</span> validate<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>validate <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> validate <span style="color: #990000">&lt;=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> validate<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>

                reader <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_reader_memory</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">));</span>
                writer <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_memory</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>buf<span style="color: #990000">));</span>

                <span style="font-style: italic"><span style="color: #9A1900">/* Validating read/write */</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>avro_write_data
                    <span style="color: #990000">(</span>writer<span style="color: #990000">,</span> validate <span style="color: #990000">?</span> writers_schema <span style="color: #990000">:</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Unable to write %s validate=%d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                                type<span style="color: #990000">,</span> validate<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="color: #008080">int64_t</span> size <span style="color: #990000">=</span>
                    <span style="font-weight: bold"><span style="color: #000000">avro_size_data</span></span><span style="color: #990000">(</span>writer<span style="color: #990000">,</span> validate <span style="color: #990000">?</span> writers_schema <span style="color: #990000">:</span> NULL<span style="color: #990000">,</span>
                                   datum<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>size <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_tell</span></span><span style="color: #990000">(</span>writer<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span>
                                <span style="color: #FF0000">"Unable to calculate size %s validate=%d (%"</span>PRId64<span style="color: #FF0000">" != %"</span>PRId64<span style="color: #FF0000">")</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                                type<span style="color: #990000">,</span> validate<span style="color: #990000">,</span> size<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">avro_writer_tell</span></span><span style="color: #990000">(</span>writer<span style="color: #990000">));</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>avro_read_data
                    <span style="color: #990000">(</span>reader<span style="color: #990000">,</span> writers_schema<span style="color: #990000">,</span> readers_schema<span style="color: #990000">,</span> <span style="color: #990000">&amp;</span>datum_out<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"Unable to read %s validate=%d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> type<span style="color: #990000">,</span>
                                validate<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(!</span><span style="font-weight: bold"><span style="color: #000000">avro_datum_equal</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">,</span> datum_out<span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span>
                                <span style="color: #FF0000">"Unable to encode/decode %s validate=%d</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span>
                                type<span style="color: #990000">,</span> validate<span style="color: #990000">);</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>

                <span style="font-weight: bold"><span style="color: #000000">avro_reader_dump</span></span><span style="color: #990000">(</span>reader<span style="color: #990000">,</span> stderr<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum_out<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_reader_free</span></span><span style="color: #990000">(</span>reader<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_writer_free</span></span><span style="color: #990000">(</span>writer<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_string</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">const</span></span> <span style="color: #009900">char</span> <span style="color: #990000">*</span>strings<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="color: #FF0000">"Four score and seven years ago"</span><span style="color: #990000">,</span>
                <span style="color: #FF0000">"our father brought forth on this continent"</span><span style="color: #990000">,</span>
                <span style="color: #FF0000">"a new nation"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"conceived in Liberty"</span><span style="color: #990000">,</span>
                <span style="color: #FF0000">"and dedicated to the proposition that all men are created equal."</span>
        <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> writer_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_string</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>strings<span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>strings<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapstring</span></span><span style="color: #990000">(</span>strings<span style="color: #990000">[</span>i<span style="color: #990000">]);</span>
                <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"string"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_bytes</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">char</span> bytes<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="color: #993399">0xDE</span><span style="color: #990000">,</span> <span style="color: #993399">0xAD</span><span style="color: #990000">,</span> <span style="color: #993399">0xBE</span><span style="color: #990000">,</span> <span style="color: #993399">0xEF</span> <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> writer_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_bytes</span></span><span style="color: #990000">();</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapbytes</span></span><span style="color: #990000">(</span>bytes<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>bytes<span style="color: #990000">));</span>

        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"bytes"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_int32</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> writer_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_int</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #993399">100</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand_int32</span></span><span style="color: #990000">());</span>
                <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"int"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_int64</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> writer_schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_long</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #993399">100</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int64</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand_int64</span></span><span style="color: #990000">());</span>
                <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"long"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>writer_schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_double</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_double</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #993399">100</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_double</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand_number</span></span><span style="color: #990000">(-</span><span style="color: #993399">1.0E10</span><span style="color: #990000">,</span> <span style="color: #993399">1.0E10</span><span style="color: #990000">));</span>
                <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"double"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_float</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_double</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #993399">100</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_double</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand_number</span></span><span style="color: #990000">(-</span><span style="color: #993399">1.0E10</span><span style="color: #990000">,</span> <span style="color: #993399">1.0E10</span><span style="color: #990000">));</span>
                <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"float"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_boolean</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_boolean</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_boolean</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"boolean"</span><span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_null</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_null</span></span><span style="color: #990000">();</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_null</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"null"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_record</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_record</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"person"</span><span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_record</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"person"</span><span style="color: #990000">,</span> NULL<span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> name_datum<span style="color: #990000">,</span> age_datum<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #000000">avro_schema_record_field_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"name"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_string</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_record_field_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"age"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_int</span></span><span style="color: #990000">());</span>

        name_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapstring</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Joseph Campbell"</span><span style="color: #990000">);</span>
        age_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32</span></span><span style="color: #990000">(</span><span style="color: #993399">83</span><span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">,</span> <span style="color: #FF0000">"name"</span><span style="color: #990000">,</span> name_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_record_set</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">,</span> <span style="color: #FF0000">"age"</span><span style="color: #990000">,</span> age_datum<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"record"</span><span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>name_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>age_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_enum</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">enum</span></span> avro_languages <span style="color: #FF0000">{</span>
                AVRO_C<span style="color: #990000">,</span>
                AVRO_CPP<span style="color: #990000">,</span>
                AVRO_PYTHON<span style="color: #990000">,</span>
                AVRO_RUBY<span style="color: #990000">,</span>
                AVRO_JAVA
        <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"language"</span><span style="color: #990000">);</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_enum</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"language"</span><span style="color: #990000">,</span> AVRO_C<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum_symbol_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"C"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum_symbol_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"C++"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum_symbol_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"Python"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum_symbol_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"Ruby"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_enum_symbol_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="color: #FF0000">"Java"</span><span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"enum"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_array</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">int</span> i<span style="color: #990000">,</span> rval<span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_array</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_schema_int</span></span><span style="color: #990000">());</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_array</span></span><span style="color: #990000">();</span>

        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="color: #993399">10</span><span style="color: #990000">;</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> i32_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int32</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
                rval <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_array_append_datum</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">,</span> i32_datum<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>i32_datum<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>rval<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #000000">exit</span></span><span style="color: #990000">(</span>EXIT_FAILURE<span style="color: #990000">);</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>

        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"array"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_map</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_map</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">avro_schema_long</span></span><span style="color: #990000">());</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_map</span></span><span style="color: #990000">();</span>
        <span style="color: #008080">int64_t</span> i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
        <span style="color: #009900">char</span> <span style="color: #990000">*</span>nums<span style="color: #990000">[]</span> <span style="color: #990000">=</span>
            <span style="color: #FF0000">{</span> <span style="color: #FF0000">"zero"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"one"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"two"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"three"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"four"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"five"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"six"</span><span style="color: #990000">,</span> NULL <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>nums<span style="color: #990000">[</span>i<span style="color: #990000">])</span> <span style="color: #FF0000">{</span>
                <span style="color: #008080">avro_datum_t</span> i_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_int64</span></span><span style="color: #990000">(</span>i<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_map_set</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">,</span> nums<span style="color: #990000">[</span>i<span style="color: #990000">],</span> i_datum<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>i_datum<span style="color: #990000">);</span>
                i<span style="color: #990000">++;</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"map"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_union</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_union</span></span><span style="color: #990000">();</span>
        <span style="color: #008080">avro_datum_t</span> union_datum<span style="color: #990000">;</span>
        <span style="color: #008080">avro_datum_t</span> datum<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #000000">avro_schema_union_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_string</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_union_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_int</span></span><span style="color: #990000">());</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_union_append</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_null</span></span><span style="color: #990000">());</span>

        datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapstring</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Follow your bliss."</span><span style="color: #990000">);</span>
        union_datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_union</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span> datum<span style="color: #990000">);</span>

        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> union_datum<span style="color: #990000">,</span> <span style="color: #FF0000">"union"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>union_datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="font-weight: bold"><span style="color: #0000FF">static</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">test_fixed</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">char</span> bytes<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{</span> <span style="color: #993399">0xD</span><span style="color: #990000">,</span> <span style="color: #993399">0xA</span><span style="color: #990000">,</span> <span style="color: #993399">0xD</span><span style="color: #990000">,</span> <span style="color: #993399">0xA</span><span style="color: #990000">,</span> <span style="color: #993399">0xB</span><span style="color: #990000">,</span> <span style="color: #993399">0xA</span><span style="color: #990000">,</span> <span style="color: #993399">0xB</span><span style="color: #990000">,</span> <span style="color: #993399">0xA</span> <span style="color: #FF0000">}</span><span style="color: #990000">;</span>
        <span style="color: #008080">avro_schema_t</span> schema <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_schema_fixed</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"msg"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>bytes<span style="color: #990000">));</span>
        <span style="color: #008080">avro_datum_t</span> datum <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">avro_wrapfixed</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"msg"</span><span style="color: #990000">,</span> bytes<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>bytes<span style="color: #990000">));</span>
        <span style="font-weight: bold"><span style="color: #000000">write_read_check</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">,</span> NULL<span style="color: #990000">,</span> datum<span style="color: #990000">,</span> <span style="color: #FF0000">"fixed"</span><span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_datum_decref</span></span><span style="color: #990000">(</span>datum<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #000000">avro_schema_decref</span></span><span style="color: #990000">(</span>schema<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">0</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">main</span></span><span style="color: #990000">(</span><span style="color: #009900">void</span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
        <span style="color: #009900">unsigned</span> <span style="color: #009900">int</span> i<span style="color: #990000">;</span>
        <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_tests</span> <span style="color: #FF0000">{</span>
                <span style="color: #009900">char</span> <span style="color: #990000">*</span>name<span style="color: #990000">;</span>
                <span style="color: #008080">avro_test</span> func<span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span> tests<span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"string"</span><span style="color: #990000">,</span> test_string<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"bytes"</span><span style="color: #990000">,</span> test_bytes<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"int"</span><span style="color: #990000">,</span> test_int32<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"long"</span><span style="color: #990000">,</span> test_int64<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"float"</span><span style="color: #990000">,</span> test_float<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"double"</span><span style="color: #990000">,</span> test_double<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"boolean"</span><span style="color: #990000">,</span> test_boolean<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"null"</span><span style="color: #990000">,</span> test_null<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"record"</span><span style="color: #990000">,</span> test_record<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"enum"</span><span style="color: #990000">,</span> test_enum<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"array"</span><span style="color: #990000">,</span> test_array<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"map"</span><span style="color: #990000">,</span> test_map<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"fixed"</span><span style="color: #990000">,</span> test_fixed<span style="color: #FF0000">}</span><span style="color: #990000">,</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"union"</span><span style="color: #990000">,</span> test_union<span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span><span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #000000">init_rand</span></span><span style="color: #990000">();</span>
        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>i <span style="color: #990000">=</span> <span style="color: #993399">0</span><span style="color: #990000">;</span> i <span style="color: #990000">&lt;</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>tests<span style="color: #990000">)</span> <span style="color: #990000">/</span> <span style="font-weight: bold"><span style="color: #0000FF">sizeof</span></span><span style="color: #990000">(</span>tests<span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">]);</span> i<span style="color: #990000">++)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">struct</span></span> <span style="color: #008080">avro_tests</span> <span style="color: #990000">*</span>test <span style="color: #990000">=</span> tests <span style="color: #990000">+</span> i<span style="color: #990000">;</span>
                <span style="font-weight: bold"><span style="color: #000000">fprintf</span></span><span style="color: #990000">(</span>stderr<span style="color: #990000">,</span> <span style="color: #FF0000">"**** Running %s tests ****</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">,</span> test<span style="color: #990000">-&gt;</span>name<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span>test<span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">func</span></span><span style="color: #990000">()</span> <span style="color: #990000">!=</span> <span style="color: #993399">0</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_FAILURE<span style="color: #990000">;</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> EXIT_SUCCESS<span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2010-03-25 14:47:20 PDT
</div>
</div>
</body>
</html>
